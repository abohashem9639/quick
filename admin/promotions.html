<!-- promotions.html -->
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promosyon Yönetimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>

    <style>
        :root {
            --bg-color: #121212;
            --text-color: #ffffff;
            --navbar-bg-color: #1c1c1c;
            --border-color: #444;
            --primary-color: red;
            --primary-hover-color: #e65c00;
            --card-bg-color: #1c1c1c;
            --muted-text-color: #bbb;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
        }
        .container {
            padding-left: 10px;
            padding-right: 10px;
            margin-left: auto;
            margin-right: auto;
        }
        .navbar {
            background-color: var(--navbar-bg-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .navbar-brand {
            color: var(--primary-color) !important;
            font-weight: bold;
            font-size: 1.5rem;
            text-align: left;
        }
        .navbar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }
        .nav-item {
            margin-left: 15px;
        }
        .nav-link {
            color: var(--text-color) !important;
            font-size: 1.1rem;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-link:hover,
        .nav-link.active {
            color: var(--primary-color) !important;

        }

        .btn-primary {
    background-color: var(--primary-color);
    border-radius: 8px;
    font-size: 15px;
    padding: 5px 10px;
    margin: 20px auto; /* Yatay ortalamayı sağlar */
    display: block; /* Ortalamayı desteklemek için blok düzeyine getirir */
    text-align: center; /* Metni ortalar */
}

        .btn-primary:hover {
            background-color: var(--primary-hover-color);
        }

        .card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            text-align: center;
            padding: 15px;
        }

        .card img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            margin-bottom: 10px;
            border-radius: 10px;
        }

        .card-title {
            font-size: 1rem;
            margin: 10px 0;
        }

        .card p {
            color: var(--muted-text-color);
        }

        .sidebar p,
        .sidebar ul {
            text-align: left;
            color: var(--muted-text-color);
        }

        .sidebar h5 {
            text-align: left;
        }

        .sidebar {
    background-color: var(--card-bg-color);
    padding: 15px;
    border-radius: 8px;
    height: 100vh; /* Tam ekran yüksekliği */
    position: sticky; /* Sayfada sabitlenir */
    top: 0; /* Üstten sıfır konumunda başlar */
    overflow-y: auto; /* Yatay kaydırma yok, dikey kaydırma aktif */
    max-width: 300px; /* Genişliği sabitler */
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2); /* Hafif gölge efekti */
}


.sidebar {
    background-color: var(--card-bg-color);
    padding: 15px;
    border-radius: 8px;
    max-height: 100%; /* Fazla içerik için sınır */
    overflow-y: auto; /* İçerik taşarsa kaydırılabilir yap */
    position: sticky; /* Sabit kalması için */
    top: 10px; /* Üstten biraz boşluk bırak */
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2); /* Hafif gölge */
}

/* Küçük ekranlar için */
@media (max-width: 768px) {
    .sidebar {
        position: relative; /* Sabit pozisyonu kaldır */
        margin: 0 auto; /* Ortala */
        width: 90%; /* Genişliği azalt */
    }
}


/* Kaydırma çubuğunu gizle */
.sidebar::-webkit-scrollbar {
    display: none; /* Chrome, Edge ve Safari için kaydırma çubuğunu gizler */
}

.sidebar {
    -ms-overflow-style: none;  /* Internet Explorer ve Edge için gizle */
    scrollbar-width: none; /* Firefox için gizle */
}


        .product-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .product-item {
            flex: 1 1 calc(20% - 15px);
        }

        @media (max-width: 1200px) {
            .product-item {
                flex: 1 1 calc(25% - 15px);
            }
        }

        @media (max-width: 992px) {
            .product-item {
                flex: 1 1 calc(33.33% - 15px);
            }
        }

        @media (max-width: 768px) {
            .product-item {
                flex: 1 1 calc(50% - 15px);
            }
        }

        @media (max-width: 576px) {
            .product-item {
                flex: 1 1 100%;
            }
        }

        .container .baslik{
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Quick</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav" dir="ltr">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="manage_orders.php">Siparişleri Yönet</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="add_product.php">Ürünleri Yönet</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="promotions.html">Promosyon Yönetimi</a>
                    </li> 
                    <li class="nav-item">
                        <a class="nav-link" href="customer_history.php">Müşteri Geçmişi</a>
                    </li> 
                    <li class="nav-item">
                        <a class="nav-link" href="sales_analytics.php">Satış Analitikleri</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="logout.php">Çıkış Yap</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
    <!-- Sidebar -->
    <div class="col-lg-4">
        <div class="sidebar">
            <h4>Mevcut Kampanyalar</h4>
            <div id="promotions-container" class="mt-3">
                <!-- Kampanyalar dinamik olarak buraya gelecek -->
            </div>
        </div>
    </div>

    <!-- Sağ Taraf -->
    <div class="col-lg-8">
        <h2 class="baslik">Promosyon Yönetimi</h2>
        <form id="promotion-form" onsubmit="addPromotion(event)">
            <div class="mb-3">
                <label for="name">Promosyon Adı</label>
                <input type="text" id="name" name="name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="description">Açıklama</label>
                <textarea id="description" name="description" class="form-control"></textarea>
            </div>
            <div class="mb-3">
                <label for="discount">İndirim (%)</label>
                <input type="number" id="discount" name="discount" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="start_date">Başlangıç Tarihi ve Saati</label>
                <input type="text" id="start_date" name="start_date" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="end_date">Bitiş Tarihi ve Saati</label>
                <input type="text" id="end_date" name="end_date" class="form-control" required>
            </div>            
            <div id="product-list" class="product-list">
                <!-- Ürün listesi burada dinamik olarak yüklenecek -->
            </div>
            <button type="submit" class="btn btn-primary mt-3">Promosyon Ekle</button>
        </form>
    </div>
</div>

    </div>

    <script>
        async function fetchProducts() {
            const response = await fetch('fetch_products.php');
            const products = await response.json();
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';

            if (products.length === 0) {
                productList.innerHTML = '<div class="alert alert-info w-100">Bu restorana ait ürün bulunamadı.</div>';
                return;
            }

            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.classList.add('product-item');

                const card = document.createElement('div');
                card.classList.add('card');

                const img = document.createElement('img');
                img.src = `../uploads/${product.image}`;
                img.alt = product.name;

                const title = document.createElement('h5');
                title.classList.add('card-title');
                title.textContent = product.name;

                const price = document.createElement('p');
                price.textContent = `${product.price} TL`;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'product_ids[]';
                checkbox.value = product.id;

                card.appendChild(img);
                card.appendChild(title);
                card.appendChild(price);
                card.appendChild(checkbox);

                productItem.appendChild(card);
                productList.appendChild(productItem);
            });
        }

        async function fetchPromotions() {
    const response = await fetch('fetch_promotions.php'); // PHP dosyasının adı burada
    const promotions = await response.json();

    const promotionsContainer = document.getElementById('promotions-container');
    promotionsContainer.innerHTML = '';
    if (promotions.length === 0) {
        promotionsContainer.innerHTML = '<div class="alert alert-info">Henüz kampanya bulunmamaktadır.</div>';
        return;
    }

    promotions.forEach(promotion => {
        let productsList = '';
        if (promotion.products && promotion.products.length > 0) {
            productsList = '<ul>';
            promotion.products.forEach(product => {
                productsList += `<li>${product.name}</li>`;
            });
            productsList += '</ul>';
        } else {
            productsList = '<p>Bu kampanyaya dahil ürün bulunmamaktadır.</p>';
        }

        const promotionDiv = document.createElement('div');
        promotionDiv.className = 'card mb-3';
        promotionDiv.innerHTML = `
            <div class="card-body">
                <h5>${promotion.name}</h5>
                <p>${promotion.description || 'Açıklama Yok'}</p>
                <p><strong>İndirim:</strong> ${promotion.discount}%</p>
                <p><strong>Başlangıç:</strong> ${promotion.start_date}</p>
                <p><strong>Bitiş:</strong> ${promotion.end_date}</p>
                <h6>Dahil Olan Ürünler:</h6>
                ${productsList}
            </div>
        `;
        promotionsContainer.appendChild(promotionDiv);
    });
}



        async function addPromotion(event) {
            event.preventDefault();
            const formData = new FormData(document.getElementById('promotion-form'));
            const response = await fetch('manage_promotions.php', {
                method: 'POST',
                body: formData
            });
            alert(await response.text());
            fetchPromotions();
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchProducts();
            fetchPromotions();
        });

document.addEventListener('DOMContentLoaded', function () {
    flatpickr("#start_date", {
        locale: "tr",
        enableTime: true, // Saat seçimini etkinleştir
        time_24hr: true,  // 24 saat formatını kullan
        dateFormat: "Y-m-d H:i", // Tarih ve saat formatı
    });

    flatpickr("#end_date", {
        locale: "tr",
        enableTime: true, // Saat seçimini etkinleştir
        time_24hr: true,  // 24 saat formatını kullan
        dateFormat: "Y-m-d H:i", // Tarih ve saat formatı
    });
});


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
